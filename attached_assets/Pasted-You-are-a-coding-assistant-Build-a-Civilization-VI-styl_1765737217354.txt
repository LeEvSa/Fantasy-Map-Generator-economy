You are a coding assistant. Build a Civilization VI–style resource system for a turn-based 4X game.
IMPORTANT: This is NOT a production-chain economy (no “iron -> steel -> tanks”). Resources are map nodes that are claimed, improved, revealed by tech, and used as gates/stockpiles/empire modifiers.

## Goal
Implement a modular “classic resources” simulation (iron/coal/oil/wheat/gems etc.) where:
- Resources spawn on map tiles based on terrain/biome rules.
- Players claim tiles via borders/ownership.
- Improvements activate resources and modify tile yields.
- Strategic resources accumulate into stockpiles (with caps) and are spent/consumed.
- Luxury resources give non-stacking empire benefits (unique luxuries matter; duplicates become trade value).
- Bonus resources mostly boost tile yields.
- Tech unlocks reveal access to hidden resources (iron shows later, oil later, etc.).
- Optional diplomacy/trade system to exchange resources.

## Non-goals
- No multi-step crafting/production chains.
- No fully simulated market economy with prices for every good (keep it Civ-like, rules-based).
- Keep it readable and testable.

## Implementation Requirements
1) Data model
- Tile: coordinates, terrain type, biome, owner (playerId or None), cityId (optional), resource (optional), improvement (optional), base yields.
- ResourceDefinition:
  - id, category: BONUS | LUXURY | STRATEGIC
  - spawn rules: allowed terrains/biomes, rarity weight, clustering flag
  - revealTech (optional): resource exists on map but invisible until tech unlocked
  - improvementRequired (optional): e.g., mine/pasture/plantation/well
  - tileYieldDelta when improved (e.g., +1 Production)
  - For STRATEGIC: perTurnIncome when improved; optional perTurnUpkeepConsumers list
  - For LUXURY: amenityValue, uniqueOnly=true (duplicates don’t add amenities)
- ImprovementDefinition:
  - id, buildCost (turns or worker charges), valid resource categories/ids, tileYieldDelta, activatesResource=true/false
- TechDefinition:
  - id, revealsResources: [resourceId...]

2) World generation (deterministic)
- Function generate_map(seed, width, height) => tiles with terrain/biome assigned + resource placement.
- Resource placement must respect spawn rules and rarity weights.
- Resources with revealTech should be placed “hidden” initially (not visible to players without the tech).

3) Player economy state
- Player:
  - ownedTiles set
  - knownTech set
  - strategicStockpiles dict[resourceId] = amount
  - strategicCaps dict[resourceId] = cap (base cap + modifiers)
  - luxuryUniquesOwned set[resourceId]
  - amenitiesTotal (computed)
- Stockpile rules:
  - Each turn: strategic += sum(income from improved owned tiles) - sum(upkeep consumption)
  - Clamp to [0, cap]
- Spending rules:
  - build_unit(player, unitDef) checks required strategic costs, subtracts if possible.
  - Optional: some units/buildings have ongoing strategic upkeep (perTurn consumption).

4) Luxury rules (Civ-like)
- Each UNIQUE luxury owned grants amenities (or happiness) once.
- Duplicate copies provide no extra amenities but can be traded.
- Provide a function compute_amenities(player) from current owned improved luxuries.

5) Visibility / reveal rules
- Player can only “see” resources if:
  - Tile is in explored/known area (you can stub exploration as “all tiles visible” for now), AND
  - Player has the tech that reveals the resource (if revealTech exists).
- Provide get_visible_resources(player) or tile_view(player) helper.

6) Trading system (simple but useful)
- Provide trade_resource(fromPlayer, toPlayer, resourceId, quantity, durationTurns optional).
- For valuation, implement a simple AI scoring function:
  - High value if receiving player lacks that luxury unique (amenity boost)
  - High value if receiving player is short on a strategic needed for units/upkeep
  - Lower value for duplicates
- Keep it simple and deterministic (no ML).

7) UI helpers (very important)
Provide summary outputs like:
- “Iron: +3/turn, -1/turn upkeep, stockpile 24/50”
- A breakdown: income sources and consumers per strategic resource.
- A list of luxuries owned unique vs duplicates.

## Deliverables
- Choose a language and stick to it (prefer Python 3.11 with dataclasses + type hints, unless stated otherwise).
- Provide clean, commented code in a single file.
- Include a small demo:
  - Generate a map
  - Create 2 players with different tech
  - Claim tiles + build improvements
  - Run 10 turns showing stockpile changes and amenity totals
  - Show that hidden resources appear after unlocking a tech
- Include minimal unit tests or assertion checks for:
  - stockpile clamping
  - luxury uniqueness (duplicates don’t stack)
  - reveal logic works
  - spending cannot go negative

## Extra constraints
- Keep numbers configurable (resource income, costs, caps) via a dict/JSON-like config at top of file.
- Avoid overengineering. Prioritize correctness + clarity + “Civ-like feel”.

Start by outlining the architecture briefly, then write the code.
